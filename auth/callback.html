<script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js";
    
    // üîê Inserisci qui le tue chiavi pubbliche
    const SUPABASE_URL = "https://dcdccwtkblubmdolkqey.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRjZGNjd3RrYmx1Ym1kb2xrcWV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3Mzk4MzksImV4cCI6MjA3NzMxNTgzOX0.v_iuUfnW7CBi0SP0VOzKCk_iRrGKYsEqaSoM3Exz1zo";
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    async function init() {
      // 1. Controlla se l‚Äôutente √® loggato
      const { data: { user } } = await supabase.auth.getUser();
    
      if (!user) {
        // Se non c‚Äô√® l‚Äôutente ‚Üí torna al login
        window.location.href = "/pages/login.html";
        return;
      }
    
      // 2. Recupera profilo e tipo di utente
      const { data: profile, error } = await supabase
        .from("profiles")
        .select("user_type")
        .eq("user_id", user.id)
        .single();
    
      if (error || !profile) {
        console.error("Errore nel recupero profilo:", error);
        window.location.href = "/pages/login.html";
        return;
      }
    
      // 3. Redirect in base al tipo di utente
      if (profile.user_type === "corporate") {
        window.location.href = "/pages/corporate/simplified-questionnaire.html";
      } else {
        window.location.href = "/pages/login.html";
      }
    }
    
    init();
    </script>