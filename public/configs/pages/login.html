<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accedi • HealthInsight</title>
  <meta name="description" content="Accedi per compilare i questionari, vedere gli score di rischio e ricevere consigli personalizzati." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/app.css" />
  <style>
    :root{
      --bg:#0c0f14;           /* dark bluish */
      --panel:#121622;
      --panel-2:#0f1420;
      --ink:#e6f0ff;
      --muted:#a9b7d0;
      --brand:#8a2be2;        /* violet */
      --brand-2:#00c2ff;      /* cyan */
      --ok:#28c76f;
      --err:#ff6b6b;
      --focus: 0 0 0 3px rgba(0,194,255,.25), 0 0 0 6px rgba(138,43,226,.2);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Poppins, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 10% -10%, rgba(0,194,255,.12), transparent 60%),
                  radial-gradient(900px 600px at 110% -20%, rgba(138,43,226,.12), transparent 60%),
                  linear-gradient(180deg, var(--panel-2), var(--bg));
      color: var(--ink);
    }
    .wrap{min-height:100%; display:grid; grid-template-rows:auto 1fr auto}
    header{position:sticky; top:0; backdrop-filter:saturate(160%) blur(6px); background:rgba(12,15,20,.6); border-bottom:1px solid rgba(255,255,255,.06); z-index:20}
    .container{max-width:1080px; margin:0 auto; padding:16px 20px}
    .brand{display:flex; gap:12px; align-items:center; text-decoration:none; color:var(--ink)}
    .brand .logo{width:34px; height:34px; display:grid; place-items:center; border-radius:10px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow:0 6px 20px rgba(0,194,255,.18)}
    .brand span{font-family: Space Grotesk, Poppins, sans-serif; font-weight:700; letter-spacing:.4px}

    main{display:grid; place-items:center; padding:40px 16px}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:28px; width:100%; max-width:1080px}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr} }

    .panel{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .p24{padding:24px}
    .p32{padding:32px}

    h1{margin:0 0 8px; font-family: Space Grotesk, Poppins, sans-serif; font-size:30px; letter-spacing:.2px}
    p.muted{margin:0 0 22px; color:var(--muted)}

    .field{display:grid; gap:8px; margin:16px 0}
    label{font-size:14px; color:#cfe2ff}
    input[type="email"], input[type="password"]{
      width:100%; padding:14px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background:rgba(6,10,16,.6); color:var(--ink); outline:none; transition:.15s ease; font-size:15px
    }
    input:focus{box-shadow: var(--focus); border-color: rgba(0,194,255,.45)}

    .row{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:6px}
    .remember{display:flex; align-items:center; gap:10px; color:var(--muted); font-size:13px}
    .remember input{accent-color: var(--brand)}

    .btn{appearance:none; border:0; padding:14px 16px; border-radius:12px; font-weight:600; cursor:pointer; transition:.15s ease; display:inline-flex; gap:10px; align-items:center}
    .btn-primary{background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:#06101a; box-shadow:0 10px 30px rgba(0,194,255,.22)}
    .btn-primary:hover{transform: translateY(-1px)}
    .btn-ghost{background:transparent; color:var(--ink); border:1px solid rgba(255,255,255,.14)}
    .btn-ghost:hover{background:rgba(255,255,255,.04)}
    .btn-full{width:100%; justify-content:center}

    .alt{display:grid; gap:12px; margin-top:14px}
    .or{display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:10px; color:var(--muted); font-size:13px; margin:14px 0}
    .or::before, .or::after{content:""; height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent)}

    .error, .success{display:none; margin-top:10px; padding:10px 12px; border-radius:10px; font-size:14px}
    .error{background: rgba(255,107,107,.08); border:1px solid rgba(255,107,107,.35); color:#ffd6d6}
    .success{background: rgba(40,199,111,.08); border:1px solid rgba(40,199,111,.35); color:#d7ffe7}

    .illus{position:relative; overflow:hidden}
    .illus .card{height:100%;}
    .badge{display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px; background:rgba(0,194,255,.12); border:1px solid rgba(0,194,255,.25); color:#bfefff; font-size:12px}
    .kpi{display:flex; gap:14px; flex-wrap:wrap; margin-top:18px}
    .kpi .chip{padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03); font-size:13px; color:var(--muted)}
    .hint{font-size:12px; color:var(--muted); margin-top:10px}
    a{color:#c1d9ff}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:14px">
      <a class="brand" href="/index.html" aria-label="Home">
        <div class="logo" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 12c0-4.418 3.582-8 8-8" stroke="white" stroke-width="2" stroke-linecap="round"/>
            <path d="M20 12c0 4.418-3.582 8-8 8" stroke="white" stroke-width="2" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="2.5" fill="white"/>
          </svg>
        </div>
        <span>HealthInsight</span>
      </a>
      <nav style="display:flex; gap:14px">
        <a class="btn btn-ghost" href="/index.html">Home</a>
        <a class="btn btn-ghost" href="/index.html#about">Chi siamo</a>
        <a class="btn btn-ghost" href="/index.html#contatti">Contatti</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- Login panel -->
      <section class="panel p32" aria-label="Pannello di accesso">
        <h1>Accedi</h1>
        <p class="muted">Entra per continuare la compilazione dei questionari e vedere dashboard e consigli personalizzati.</p>

        <form id="loginForm" novalidate>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" inputmode="email" placeholder="es. nome@dominio.it" required />
          </div>

          <div class="field">
            <label for="password" style="display:flex; align-items:center; justify-content:space-between">
              <span>Password</span>
              <button type="button" class="btn btn-ghost" id="togglePwd" aria-pressed="false" aria-controls="password" style="padding:6px 10px; font-size:12px">Mostra</button>
            </label>
            <input id="password" name="password" type="password" autocomplete="current-password" minlength="8" placeholder="Minimo 8 caratteri" required />
          </div>

          <div class="row">
            <label class="remember">
              <input type="checkbox" id="remember" name="remember" /> Ricordami su questo dispositivo
            </label>
            <a href="#" id="resetLink">Password dimenticata?</a>
          </div>

          <div class="error" id="errorBox" role="alert"></div>
          <div class="success" id="successBox" role="status"></div>

          <div style="margin-top:18px; display:grid; gap:10px">
            <button class="btn btn-primary btn-full" id="loginBtn" type="submit">Accedi</button>
            <button class="btn btn-ghost btn-full" id="toRegister" type="button">Crea un account</button>
          </div>

          <div class="or">oppure</div>

          <div class="alt">
            <button class="btn btn-ghost btn-full" type="button" id="googleBtn" disabled title="Presto disponibile">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21.35 11.1h-9.18v2.98h5.27c-.23 1.5-1.6 4.4-5.27 4.4-3.17 0-5.75-2.62-5.75-5.86s2.58-5.86 5.75-5.86c1.81 0 3.02.77 3.71 1.43l2.53-2.44C17.6 3.89 15.6 3 13.17 3 8.33 3 4.39 6.94 4.39 11.68c0 4.74 3.94 8.68 8.78 8.68 5.07 0 8.42-3.56 8.42-8.57 0-.57-.06-1.12-.16-1.69z" fill="currentColor"/></svg>
              Accedi con Google
            </button>
            <p class="hint">L'accesso con Google e il ripristino password via email saranno abilitati quando colleghiamo il backend (es. Supabase).</p>
          </div>
        </form>
      </section>

      <!-- Visual/benefits panel -->
      <aside class="panel p24 illus" aria-label="Informazioni sulla sicurezza e vantaggi">
        <div class="badge">Sicurezza & Privacy</div>
        <h2 style="font-family:Space Grotesk, Poppins, sans-serif; font-size:22px; margin:10px 0 8px">Dati sanitari: tu controlli l'accesso</h2>
        <p class="muted" style="margin:0 0 14px">Usiamo storage crittografato e controlli granulari. Puoi esportare o cancellare i tuoi dati in qualunque momento.</p>
        <div class="kpi">
          <div class="chip">Crittografia in transito & riposo</div>
          <div class="chip">Accesso per scopi dichiarati</div>
          <div class="chip">Portabilità & diritto all'oblio</div>
        </div>
        <hr style="border:0; border-top:1px solid rgba(255,255,255,.08); margin:18px 0" />
        <div class="badge">Perché creare un account?</div>
        <ul style="margin:12px 0 0 18px; color:var(--muted)">
          <li>Salvataggio progressi tra le macroaree</li>
          <li>Dashboard con <em>score</em> e consigli personalizzati</li>
          <li>Report esportabili per il tuo medico</li>
        </ul>
        <div class="hint">Hai già effettuato l'accesso su questo dispositivo? Il pulsante mostrerà “Vai alla dashboard”.</div>
      </aside>
    </div>
  </main>

  <footer style="border-top:1px solid rgba(255,255,255,.08); background:rgba(12,15,20,.6)">
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:14px; font-size:13px; color:var(--muted)">
      <span>© <span id="year"></span> HealthInsight • Tutti i diritti riservati</span>
      <div style="display:flex; gap:12px">
        <a href="/index.html#contatti">Supporto</a>
        <a href="#">Informativa privacy</a>
        <a href="#">Termini</a>
      </div>
    </div>
  </footer>
</div>

<script>
  // --- Helpers ---
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => [...r.querySelectorAll(s)];
  const errorBox = $('#errorBox');
  const successBox = $('#successBox');

  // Demo: read auth token to switch CTA
  const authToken = localStorage.getItem('authToken');
  const loginBtn = $('#loginBtn');
  if (authToken) {
    loginBtn.textContent = 'Vai alla dashboard';
  }

  $('#year').textContent = new Date().getFullYear();

  // Show/Hide password
  $('#togglePwd').addEventListener('click', () => {
    const input = $('#password');
    const vis = input.getAttribute('type') === 'password' ? 'text' : 'password';
    input.setAttribute('type', vis);
    const pressed = vis === 'text';
    $('#togglePwd').setAttribute('aria-pressed', String(pressed));
    $('#togglePwd').textContent = pressed ? 'Nascondi' : 'Mostra';
  });

  // Go register
  $('#toRegister').addEventListener('click', () => {
    window.location.href = '/pages/register.html';
  });

  // Reset (placeholder)
  $('#resetLink').addEventListener('click', (e) => {
    e.preventDefault();
    successBox.style.display='block';
    successBox.textContent='Funzione presto disponibile. Riceverai un link di ripristino quando colleghiamo il backend.';
    errorBox.style.display='none';
  });

  // Form submit
  $('#loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    if (authToken) { // user already logged in
      return window.location.href = '/pages/dashboard.html';
    }

    const email = $('#email').value.trim();
    const password = $('#password').value;
    const remember = $('#remember').checked;

    errorBox.style.display='none';
    successBox.style.display='none';

    // Basic validation
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      errorBox.style.display='block';
      errorBox.textContent='Inserisci un\'email valida.';
      return;
    }
    if (!password || password.length < 8) {
      errorBox.style.display='block';
      errorBox.textContent='La password deve avere almeno 8 caratteri.';
      return;
    }

    // Try project API if exists, otherwise fallback demo
    try {
      if (window.api && typeof window.api.login === 'function') {
        const res = await window.api.login({ email, password, remember });
        if (!res || !res.ok) throw new Error(res?.message || 'Credenziali non valide');
        localStorage.setItem('authToken', res.token);
        window.location.href = '/pages/dashboard.html';
        return;
      }

      // DEMO fallback (remove when wiring Supabase):
      await new Promise(r => setTimeout(r, 400));
      const fakeToken = 'demo.' + btoa(email).replace(/=+/g,'');
      localStorage.setItem('authToken', fakeToken);
      if (!remember) sessionStorage.setItem('authSession', '1');
      window.location.href = '/pages/dashboard.html';
    } catch (err) {
      console.error(err);
      errorBox.style.display='block';
      errorBox.textContent = err.message || 'Accesso non riuscito.';
    }
  });
</script>
</body>
</html>